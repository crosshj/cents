<!--

http://stackoverflow.com/questions/12112746/how-can-i-tint-a-background-image-with-css

-->

<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Added
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Cents Personal Finance</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="theme-color" content="#746D5D">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/cents.css">
  <link rel="stylesheet" href="css/font-awesome.min.css">


  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="js/bgGrad.js"></script>

</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="column menu"></div>
      <div class="column liabilities"></div>
    </div>
  </div>
  <div id="popup-modal"></div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>

<script type="text/javascript">
  var makeRow = function(data){
    var primary = data.status.toLowerCase() !== "paid" ? " button-primary" : "";
    return $(' \
      <a class="button '+ data.status.toLowerCase() + primary + '"> \
          <table class="u-full-width"> \
            <tbody> \
              <tr class="header"> \
                <td colspan="2" class="title">' + data.title + ' <!-- i class="fa fa-info-circle"></i --></td> \
                <td class="status">'+ data.status.toUpperCase() +'</td> \
              </tr> \
              <tr class="info"> \
                <td class="amount">$'+ data.amount +'</td> \
                <td class="total">'+ data.totalOwed +'</td> \
                <td class="date">'+ data.date +'</td> \
              </tr> \
            </tbody> \
          </table> \
        </a> \
    ');
  }
  var makeMenuRow = function(data){
    var selected = data.count === 0
      ? " selected "
      : "";
    return $(' \
      <a class="button menu button-primary '+ data.name.toLowerCase() + selected + '"> \
          ' + data.name.toLowerCase() + ' \
      </a> \
    ');
  }

  function popUpModal(target, content){
   if(content){
    $('div#popup-modal').html(content);
   }
   if ($('div#popup-modal.show').length){
     $('div#popup-modal').css({top:'100%', bottom: '100%'});
     $('div#popup-modal').removeClass('show');
     $('body').removeClass('lock-screen');
   } else {
     var scrollTop = $('body').scrollTop();
     $('div#popup-modal').css({top:scrollTop, bottom: -1*scrollTop});
     $('body').addClass('lock-screen');
     $('div#popup-modal').addClass('show');
   }
   target && console.log(target.find('.amount').text());
  }

  $.get("/json",function(data){
    var menu = [
      { name: "debts" },
      { name: "totals" },
      { name: "assets" }
    ];
    menu.forEach(function(item, i){
      $('div.menu').append(makeMenuRow({ name: item.name, count: i}));
    });
    window.MAIN_DATA = data;
    //TODO: sort data
    MAIN_DATA.liabilities.forEach(function(item){
      if (item.hidden === "true") return;
      $('div.liabilities').append(makeRow({
          status: item.status,
          title: item.title,
          amount: item.amount,
          totalOwed: item.total_owed > 0 ? '$'+item.total_owed : '',
          date: item.date
      }));
    });

    $('a.button').on("click", function(e){
      switch (true){
        case $(this).is('.menu'):
          $('a.button.selected').removeClass('selected')
          $(this).addClass('selected');
          console.log('--- menu button clicked');
          break;
        case $(this).is('.paid, .pending, .due'):
          $('a.button.selected:not(".menu")').removeClass('selected')
          //$(this).addClass('selected');
          var statusItems = ['due', 'pending', 'paid'];
          var statusRow = function(status){
            return '<div class="row">' +
              statusItems.reduce(function(target, item){
                var className = ' class="' +
                  (item === status.toLowerCase() ? 'selected ' : '') +
                  item + '"';
                return target + '<button'+className+'>' + item + '</button>';
              }, '') +
            '</div>';
          }

          var content = $('<div class="container content">'
            + '<h2>'+$(this).find('.title').text()+'</h2>'
              + statusRow($(this).find('.status').text())
              + '<label>Amount</label>'
              + '<input type="number" value="'+$(this).find('.amount').text().replace(/\$/g,'')+'"/>'
              + '<button class="graph"><i class="fa fa-bar-chart"></i></button>'
              + '<label>Total</label>'
              + '<div class="row"><input type="number" value="'+$(this).find('.total').text().replace(/\$/g,'')+'"/>'
              + '<button class="graph"><i class="fa fa-bar-chart"></i></button></div>'
              + '<label>Date</label>'
              + '<input type="date" value="'+$(this).find('.date').text()+'"/>'
            + '</div>');
          typeof popUpModal === "function" && popUpModal($(this), content);
          console.log('--- paid OR pending button clicked');
          break;
        default:
          console.log('--- some other case');
          break;
      }
      console.log($(this))
    });
    $('#popup-modal').on('click', function(e){
      if(e.target !== e.currentTarget) return;
      typeof popUpModal === "function" && popUpModal();
      $('a.button.selected:not(".menu")').removeClass('selected')
    });
    $('#popup-modal .content').on('click', function(e){
      e.stopPropagation();
      return false;
    });
  });

  function handleMove(e){
    if($('div#popup-modal.show').length){
      e.preventDefault();
      return false;
    }
  }

  $(document).ready(function(){
    var colorsList = [];
    var bgColor = "rgba(81, 84, 17, 0.46)";
    backgroundGradient(colorsList, 3, 3, bgColor);
    var lockOrientation = screen.lockOrientation || screen.mozLockOrientation || screen.msLockOrientation || function(){};
    lockOrientation("portrait-primary");
    $(window).on("touchmove", handleMove);
  });
</script>
</html>
